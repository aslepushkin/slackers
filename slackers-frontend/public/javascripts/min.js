var App=function(){var t,n,e,o,s,a,i=20,c=20,l=[" "," ","Аккуратно сворачиваем письмо...","Кладем его в конверт...","Запечатываем конверт...","Клеим марку...","Бросаем в почтовый ящик...","Ждем ответа...","Еще ждем ответа...","Я вам пока анекдот расскажу...","Пишет ребенок письмо Деду Морозу...","Дорогой дедушка - пришла зима...","Ну раз вы этот знаете...","Попробую другой рассказать..."],d=3e3;$.blockUI.defaults.css.border="none",$.blockUI.defaults.css.backgroundColor="",$.blockUI.defaults.css.color="white",$.blockUI.defaults.css.fontSize="1.5em";var r=function(t){$("div.blockUI.blockMsg").text(t)},u=function(){a!==l.length&&(r(l[a]),a++,setTimeout(u,d))},f=function(){$(window).bind("scroll",function(){$(window).scrollTop()+$(window).height()>$(document).height()-100&&($(window).unbind("scroll"),h())})},p=function(t){for(var n="",e=0;e<t.length;e++){var o=t[e];n+='<li class="deputat"><img src="'+photoPath+o.photo+'"/><div class="fio">'+o.name.surname+" "+o.name.firstname+" "+o.name.patronymic+' (<a href="http://w1.c1.rada.gov.ua/pls/radan_gs09/ns_dep?vid=3&kod='+o.kod+'" target="_blank">Пруфлинк</a>)</div><div class="faction">'+o.faction.title+'</div><div class="percents">'+o.stats.percents+"<span>&nbsp;% ("+o.stats.nonregistered+" из "+o.stats.all+")</span></div></li>"}$("#slackersContainer").append(n),t&&t.length&&f()},h=function(){$.ajax("/deputies?offset="+i+"&limit="+c,{method:"GET",headers:{"X-Requested-With":"XMLHttpRequest"}}).done(function(t){p(t),i+=c}).fail(function(t,n,e){console.log(n+" : "+e)})},m=function(){$(e).attr("disabled",!0),$(o).val("")},v=function(){return a=0,$(n).block({message:"&nbsp;"}),u(),$(o).val()<=3?alert("Error"):void $.ajax("/messages",{method:"POST",headers:{"X-Requested-With":"XMLHttpRequest"},data:{author:$(s).val(),body:$(o).val()},dataType:"json"}).done(function(){a=l.length,r("Отлично! Письмо ушло адресату"),setTimeout(function(){$(n).modal("hide")},2e3)}).fail(function(){a=l.length,r("Почта вернула письмо. Это какая-то ошибка. Попробуйте отправить позднее.")}).always(function(){setTimeout(function(){$(n).unblock()},2e3)})},g=function(){return{init:function(){n=$("#messWin"),e=$("#messSendBtn"),o=$("#messBody"),s=$("#messNick"),$(n).on("show.bs.modal",m),$(e).on("click",v),$(o).on("input",function(){var t=!($(o).val().length>3);$(e).attr("disabled",t)}),f()}}};return{getInstance:function(){return t||(t=g()),t}}}(),ap=App.getInstance();$(document).ready(ap.init);